<header class="site-header" role="banner">

    <div class="wrapper">
        {%- assign default_paths = site.pages | map: "path" -%}
        {%- assign page_paths = site.header_pages | default: default_paths -%}
        <a class="site-title" rel="author" href="{{ "/" | relative_url }}">{{ site.title | escape
        }}</a>

        {%- if page_paths -%}
        <nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger"/>
            <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
            </label>

            <div class="trigger" style="display: inline-block">
                {%- for path in page_paths -%}
                {%- assign my_page = site.pages | where: "path", path | first -%}
                {%- if my_page.title -%}
                <a class="page-link" href="{{ my_page.url | relative_url }}">{{ my_page.title |
                    escape }}</a>
                {%- endif -%}
                {%- endfor -%}
            </div>

            <!-- Toogle google translation -->
            <div id="google_translate_element"
                 style="display: inline-block; font-size: smaller; padding: 5px;"></div>
            <script type="text/javascript">
                function googleTranslateElementInit() {
                    new google.translate.TranslateElement({
                        pageLanguage: 'en',
                        includedLanguages: 'en,zh-CN,zh-TW,ja,ko,de,ru,fr,es,it,pt,hi,ar',
                        layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                    }, 'google_translate_element');
                }
            </script>
            <script type="text/javascript"
                    src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
            ></script>
            <script>
                // æ›´æ”¹è°·æ­Œç¿»è¯‘çš„è¯­è¨€
                setTimeout(() => {
                    let langLink = document.querySelector('.VIpgJd-ZVi9od-xl07Ob-lTBxed'); // <a> å…ƒç´ 
                    let langSpan = langLink ? langLink.querySelector('span') : null; // è·å–ç¬¬ä¸€ä¸ª <span>

                    if (!langSpan) return;

                    // 1ï¸âƒ£ è¯»å– localStorageï¼Œæ¢å¤ç”¨æˆ·ä¸Šæ¬¡é€‰æ‹©çš„è¯­è¨€
                    let savedLang = localStorage.getItem('selectedLanguage') || 'EN'; // é»˜è®¤ "En"
                    langSpan.innerText = savedLang;

                    // 2ï¸âƒ£ ç›‘å¬ <span> çš„å˜åŒ–
                    let observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.type === "childList" || mutation.type === "characterData") {
                                let newLang = langSpan.innerText.trim(); // è·å–å½“å‰è¯­è¨€æ–‡æœ¬

                                if (newLang && newLang !== "En") {
                                    localStorage.setItem('selectedLanguage', newLang); // å­˜å‚¨ç”¨æˆ·é€‰æ‹©çš„è¯­è¨€
                                }
                            }
                        });
                    });

                    // ç›‘å¬ <span> å†…éƒ¨çš„æ–‡æœ¬å˜åŒ–
                    observer.observe(langSpan, { childList: true, subtree: true, characterData: true });

                    // // 3ï¸âƒ£ å®šæœŸæ£€æŸ¥è¯­è¨€æ˜¯å¦è¢«ä¿®æ”¹ï¼ˆé˜²æ­¢ Google ç¿»è¯‘æ’ä»¶æœªæ›´æ–° `span`ï¼‰
                    // setInterval(() => {
                    //     let currentLang = langSpan.innerText.trim();
                    //     if (!currentLang || currentLang === "") {
                    //         langSpan.innerText = "En"; // å¦‚æœä¸ºç©ºï¼Œåˆ™é»˜è®¤æ˜¾ç¤º "En"
                    //     }
                    // }, 2000); // æ¯ 2 ç§’æ£€æµ‹ä¸€æ¬¡
                }, 1000); // å»¶è¿Ÿ 1 ç§’ï¼Œç¡®ä¿ Google ç¿»è¯‘æ’ä»¶åŠ è½½å®Œæˆ

            </script>

        </nav>
        {%- endif -%}

    </div>

    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button id="theme-toggle"
            style="padding: 10px; background-color: #333; color: #fff; border: none; border-radius: 5px; cursor: pointer;">
        ğŸŒ™/â˜€ï¸
    </button>

    <!-- ä¸»é¢˜åˆ‡æ¢è„šæœ¬ -->
    <script>
        // è·å–å½“å‰ä¸»é¢˜ï¼Œé»˜è®¤æµ…è‰²
        function getPreferredTheme() {
            const savedTheme = localStorage.getItem('theme');
            // const the_theme = window.matchMedia('(prefers-color-scheme: dark)').matches;
            // if (the_theme) {
            //     return 'dark';
            // }
            // else{
            //     return 'light';
            // }
            return savedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        }

        // è®¾ç½®ä¸»é¢˜
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const currentTheme = getPreferredTheme();
            setTheme(currentTheme);
        }

        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        // ç›‘å¬æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

        // åˆå§‹åŒ–é¡µé¢æ—¶åŠ è½½å½“å‰ä¸»é¢˜
        initTheme();
    </script>

</header>
