<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {%- seo -%}
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/main.css">
    {%- feed_meta -%}
    {%- if jekyll.environment == 'production' and site.google_analytics -%}
    {%- include google-analytics.html -%}
    {%- endif -%}

    <!--  检测主题-->
    <script>
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        function getPreferredTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                return savedTheme;
            }
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function initTheme() {
            setTheme(getPreferredTheme());

            // 监听系统主题变化
            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
            const updateTheme = (e) => {
                if (!localStorage.getItem('theme')) { // 仅在未手动设置时自动变更
                    setTheme(e.matches ? 'dark' : 'light');
                }
            };

            if (mediaQuery.addEventListener) {
                mediaQuery.addEventListener('change', updateTheme);
            } else if (mediaQuery.addListener) { // 兼容旧版浏览器
                mediaQuery.addListener(updateTheme);
            }
        }

        initTheme();
    </script>


</head>
