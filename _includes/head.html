<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {%- seo -%}
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/main.css">
    {%- feed_meta -%}
    {%- if jekyll.environment == 'production' and site.google_analytics -%}
    {%- include google-analytics.html -%}
    {%- endif -%}

    <!--  检测主题-->
    <script>
        (function () {
            function setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
            }

            function getPreferredTheme() {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme) {
                    return savedTheme; // 使用本地存储的主题（用户手动设置）
                }
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; // 使用系统主题
            }

            function applyTheme() {
                const theme = getPreferredTheme();
                setTheme(theme);
            }

            function initThemeListener() {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                mediaQuery.addEventListener('change', (e) => {
                    if (!localStorage.getItem('theme')) { // 仅在用户未手动设置时变更
                        setTheme(e.matches ? 'dark' : 'light');
                    }
                });
            }

            // **1. 页面加载时立即应用主题（防止闪烁）**
            applyTheme();

            // **2. 监听系统主题变化**
            initThemeListener();
        })();
    </script>

</head>
